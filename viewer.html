<!-- viewer.html  – thin wrapper that redirects to viewer-range-plus.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Redirecting …</title>
  <script>
    (function () {
      /* ── 1. raw parts of current URL ────────────────────────────── */
      const rawSearch = window.location.search;      // includes leading “?”
      const rawHash   = window.location.hash;        // may be "" | "#" | "#!"
      const hasPlus   = rawSearch.endsWith("+");     // legacy plus-mode flag

      /* ── 2. parse search params (strip trailing “+” first) ──────── */
      const baseSearch = hasPlus ? rawSearch.slice(0, -1) : rawSearch;
      const p = new URLSearchParams(baseSearch.slice(1));   // drop leading “?”

      /* ── 3. legacy startIdx / endIdx  → randIdx ─────────────────── */
      const s = +p.get("startIdx"), e = +p.get("endIdx");
      if (!p.has("randIdx") && Number.isFinite(s) && Number.isFinite(e)) {
        p.set("randIdx", Math.floor(Math.random() * (e - s + 1)) + s);
      }
      p.delete("startIdx");
      p.delete("endIdx");

      /* ── 4. rebuild search string (re-append “+” if needed) ─────── */
      let newSearch = "?" + p.toString();
      if (hasPlus) newSearch += "+";

      /* ── 5. redirect to viewer-range-plus.html ──────────────────── */
      const newURL = "viewer-range-plus.html" + newSearch + rawHash;
      window.location.replace(newURL);   // keeps browser history clean
    })();
  </script>
</head>
<body>
  <noscript>Please enable JavaScript to view this document.</noscript>
</body>
</html>
